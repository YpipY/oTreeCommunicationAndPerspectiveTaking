{{ block title }}
    {{ if player.role == Constants.director_role }}
    <p style="line-height:1; margin:0px; margin-left:10px"> Welcome! You are the<span style="line-height:1; margin:0px; margin-left:10px; color: green">{{ player.role }} </span>
         </p>
    {{ else }}
    <p style="line-height:1; margin:0px; margin-left:10px"> Welcome! You are the<span style="line-height:1; margin:0px; margin-left:10px; color: blue">{{ player.role }} </span>
         </p>
    {{ endif }}

    <!-- To give some space for the game box and chat box -->
    <div style=" height: 40px;">
        </div>

{{ endblock }}

{{ block content }}

    <!-- Game box -->
    {{ if player.group.condition3d }}
    <div style="line-height:1;  width: 49%; height: 400px; margin-right: 11%; float:left; transform: rotateX(75deg) rotateZ(45deg);">
    {{ else }}
    <div style="line-height:1;  width: 49%; height: 400px; margin-right: 1%; float:left;">
    {{ endif }}
        <!-- Grid -->
        <div style="width: 50%; height: 200px; float:left; border:1px; border-style: none solid solid none">
            {# <div style=" height: 40px;">
                <!-- Old code of good/bad targets -->
                <!--{{ if player.role == Constants.director_role }}-->
                <!--{{ if player.group.imgavalue == True }} <p style="text-align: center; font-size: 20px; color: green"> <br><br><br>GOOD </p>-->
                <!--{{ else }} <p style="text-align: center; font-size: 20px; color: red;">  <br><br><br>BAD </p>-->
                <!--{{ endif }}-->
                <!--{{ endif }}-->
            </div>
            <div class="container">
                <div style="margin-left: 40px">
                {{ if player.role == Constants.director_role }}
                    {{ if player.group.imgavalue == True }}
                        <img src="{{ static image_patha }}" width="124px" height="124px" style="border: 4px solid green"/>
                    {{ else }}
                        <img src="{{ static image_patha }}" width="120px" height="120px"/>
                    {{ endif }}
                {{ else }}
                    <input type="image" src="{{ static image_patha }}" class="buttontrans" width="120px" height="120px" onclick="liveSend('select1')">
                {{ endif }}
                </div>
            </div> #}
        </div>
        <div style="width: 50%; height: 200px; float:right; border:1px; border-style: none none solid solid">
            {#<div style=" height: 40px;">
            </div>
            <div class="container">
                <div style="margin-left: 40px">
                {{ if player.role == Constants.director_role }}
                    {{ if player.group.imgbvalue == True }}
                        <img src="{{ static image_pathb }}" width="124px" height="124px" style="border: 4px solid green"/>
                    {{ else }}
                        <img src="{{ static image_pathb }}" width="120px" height="120px"/>
                    {{ endif }}
                {{ else }}
                    <input type="image" src="{{ static image_pathb }}" class="buttontrans" width="120px" height="120px" onclick="liveSend('select2')">
                {{ endif }}
                </div>
            </div>#}
        </div>
        <div style="width: 50%; height: 200px; float:left; border:1px; border-style: solid solid none none">
            {# <div style=" height: 40px;">
            </div>
            <div class="container">
                <div style="margin-left: 40px">
                {{ if player.role == Constants.director_role }}
                    {{ if player.group.imgcvalue == True }}
                        <img src="{{ static image_pathc }}" width="124px" height="124px" style="border: 4px solid green"/>
                    {{ else }}
                        <img src="{{ static image_pathc }}" width="120px" height="120px"/>
                    {{ endif }}
                {{ else }}
                    <input type="image" src="{{ static image_pathc }}" class="buttontrans" width="120px" height="120px" onclick="liveSend('select3')">
                {{ endif }}
                </div>
            </div> #}
        </div>
        <div style="width: 50%; height: 200px; float:right; border:1px; border-style: solid none none solid">
            {#<div style=" height: 40px;">
            </div>
            <div class="container">
                <div style="margin-left: 40px">
                {{ if player.role == Constants.director_role }}
                    {{ if player.group.imgcvalue == True }}
                        <img src="{{ static image_pathc }}" width="124px" height="124px" style="border: 4px solid green"/>
                    {{ else }}
                        <img src="{{ static image_pathc }}" width="120px" height="120px"/>
                    {{ endif }}
                {{ else }}
                    <input type="image" src="{{ static image_pathc }}" class="buttontrans" width="120px" height="120px" onclick="liveSend('select3')">
                {{ endif }}
                    </div>
            </div>#}
        </div>
    </div>
    {{ if player.group.condition3d }}
    <!-- Placing objects-->
        {{ if player.role == Constants.director_role }}
                {{ if player.group.imgavalue == True }}
                    <div style="position: absolute; top: 247px;  left: 211px">
                        <img src="{{ static image_patha }}" width="62px" height="62px" style="border: 3px solid green"/>
                    </div>
                {{ else }}
                    <div style="position: absolute; top: 250px;  left: 214px">
                        <img src="{{ static image_patha }}" width="56px" height="56px"/>
                    </div>
                {{ endif }}

                {{ if player.group.imgbvalue == True }}
                    <div style="position: absolute; top: 272px;  left: 327px">
                        <img src="{{ static image_pathb }}" width="72px" height="72px" style="border: 3px solid green"/>
                        </div>
                {{ else }}
                    <div style="position: absolute; top: 275px;  left: 330px">
                         <img src="{{ static image_pathb }}" width="66px" height="66px"/>
                    </div>
                {{ endif }}


                {{ if player.group.imgcvalue == True }}
                    <div style="position: absolute; top: 307px;  left: 197px">
                        <img src="{{ static image_pathc }}" width="86px" height="86px" style="border: 3px solid green"/>
                    </div>
                {{ else }}
                    <div style="position: absolute; top: 310px;  left: 200px">
                        <img src="{{ static image_pathc }}" width="80px" height="80px"/>
                    </div>
                {{ endif }}
        {{ else }}
            {{ if player.group.matcherpos == 1}}
                <div style="position: absolute; top: 310px;  left: 200px">
                    <input type="image" src="{{ static image_patha }}" class="buttontrans" width="80px" height="80px" onclick="liveSend('select1')">
                </div>
                <div style="position: absolute; top: 275px;  left: 90px">
                    <input type="image" src="{{ static image_pathb }}" class="buttontrans" width="66px" height="66px" onclick="liveSend('select2')">
                </div>
                <div style="position: absolute; top: 250px;  left: 214px">
                    <input type="image" src="{{ static image_pathc }}" class="buttontrans" width="56px" height="56px" onclick="liveSend('select3')">
                </div>
            {{ endif }}

            {{ if player.group.matcherpos == 2}}
                <div style="position: absolute; top: 275px;  left: 330px">
                    <input type="image" src="{{ static image_patha }}" class="buttontrans" width="66px" height="66px" onclick="liveSend('select1')">
                </div>
                <div style="position: absolute; top: 310px;  left: 200px">
                    <input type="image" src="{{ static image_pathb }}" class="buttontrans" width="80px" height="80px" onclick="liveSend('select2')">
                </div>
                <div style="position: absolute; top: 275px;  left: 90px">
                    <input type="image" src="{{ static image_pathc }}" class="buttontrans" width="66px" height="66px" onclick="liveSend('select3')">
                </div>
            {{ endif }}

            {{ if player.group.matcherpos == 3}}
                <div style="position: absolute; top: 250px;  left: 214px">
                    <input type="image" src="{{ static image_patha }}" class="buttontrans" width="56px" height="56px" onclick="liveSend('select1')">
                </div>
                <div style="position: absolute; top: 275px;  left: 330px">
                    <input type="image" src="{{ static image_pathb }}" class="buttontrans" width="66px" height="66px" onclick="liveSend('select2')">
                </div>
                <div style="position: absolute; top: 310px;  left: 200px">
                    <input type="image" src="{{ static image_pathc }}" class="buttontrans" width="80px" height="80px" onclick="liveSend('select3')">
                </div>
            {{ endif }}

            {{ if player.group.matcherpos == 4}}
                <div style="position: absolute; top: 275px;  left: 90px">
                    <input type="image" src="{{ static image_patha }}" class="buttontrans" width="66px" height="66px" onclick="liveSend('select1')">
                </div>
                <div style="position: absolute; top: 250px;  left: 200px">
                    <input type="image" src="{{ static image_pathb }}" class="buttontrans" width="56px" height="56px" onclick="liveSend('select2')">
                </div>
                <div style="position: absolute; top: 275px;  left: 330px">
                    <input type="image" src="{{ static image_pathc }}" class="buttontrans" width="66px" height="66px" onclick="liveSend('select3')">
                </div>
            {{ endif }}
        {{ endif }}
    <!-- Add silhouette -->
        {{ if player.group.silhouette_corner }}
            {{ if player.role == Constants.director_role }}
                <div style="position: absolute; top: 400px;  left: 200px" >
                    <img src="{{ static 'FruitGame/Director1.png' }}" width="60px" height="110px"/>
                </div>
                {{ if player.group.matcherpos == 1}}
                    <div style="position: absolute; top: 200px;  left: 225px" >
                        <img src="{{ static 'FruitGame/Matcher1.png' }}" width="35px" height="55px"/>
                    </div>
                {{ endif }}
                {{ if player.group.matcherpos == 2}}
                    <div style="position: absolute; top: 270px;  left: 460px" >
                        <img src="{{ static 'FruitGame/Matcher1.png' }}" width="40px" height="65px"/>
                    </div>
                {{ endif }}
                {{ if player.group.matcherpos == 3}}
                    <div style="position: absolute; top: 432px;  left: 270px" >
                        <img src="{{ static 'FruitGame/Matcher1.png' }}" width="50px" height="80px"/>
                    </div>
                {{ endif }}
                {{ if player.group.matcherpos == 4}}
                    <div style="position: absolute; top: 270px;  left: -20px" >
                        <img src="{{ static 'FruitGame/Matcher1.png' }}" width="40px" height="65px"/>
                    </div>
                {{ endif }}
            {{ else }}
                <div style="position: absolute; top: 432px;  left: 270px" >
                    <img src="{{ static 'FruitGame/Matcher1.png' }}" width="50px" height="80px"/>
                </div>
                {{ if player.group.matcherpos == 1}}
                    <div style="position: absolute; top: 190px;  left: 225px" >
                        <img src="{{ static 'FruitGame/Director1.png' }}" width="40px" height="70px"/>
                    </div>
                {{ endif }}
                {{ if player.group.matcherpos == 2}}
                    <div style="position: absolute; top: 260px;  left: -20px" >
                        <img src="{{ static 'FruitGame/Director1.png' }}" width="50px" height="90px"/>
                    </div>
                {{ endif }}
                {{ if player.group.matcherpos == 3}}
                    <div style="position: absolute; top: 400px;  left: 200px" >
                        <img src="{{ static 'FruitGame/Director1.png' }}" width="60px" height="110px"/>
                    </div>
                {{ endif }}
                {{ if player.group.matcherpos == 4}}
                    <div style="position: absolute; top: 260px;  left: 460px" >
                        <img src="{{ static 'FruitGame/Director1.png' }}" width="50px" height="90px"/>
                    </div>
                {{ endif }}
            {{ endif }}
        {{ else }}
            <div style="position: absolute; top: 155px;  left: -30px; transform: rotateY(60deg) rotateZ(-20deg);" >
                <!-- <p style="line-height:1; margin:0px; margin-left:10px"> {{ if player.role == Constants.director_role }} Matcher {{ else }} Director {{ endif }}</p> -->
                <img src="{{ static 'FruitGame/Matcher1.png' }}" width="40px" height="40px"/>
                <img src="{{ static 'FruitGame/Director1.png' }}" width="40px" height="40px"/>
            </div>
        {{ endif }}
    {{ endif }}


    <!-- Chat box -->
    <div style="line-height:1; width: 40%; height: 400px; float:right;">
        <div id="div" style="height: 80%; border: 4px groove; background-color:#e8e7e3; overflow:auto;">
            <h4 style="border:1px; border-style: none none groove none;"> Communications </h4>
            <div id="div1" style="height: 80%; background-color:#e8e7e3">
            </div>
        </div>
        {{ if player.role == Constants.director_role }}
        <div id="div3">
            <div id="div2" style="height: 10%;  border:1px; border: 4px groove; background-color:#e8e7e3; overflow:auto ;" >
            </div>
            <button type="button" class="button button1" onclick="liveSend('wa')" >wa</button>
            <button type="button" class="button button1" onclick="liveSend('bi')" >bi</button>
            <button type="button" class="button button1" style="float:right;" onclick="liveSend('send')" >send</button>
            <button type="button" class="button button1" style="float:right;" onclick="liveSend('undo')" >undo</button>
        </div>
        {{ endif }}
    </div>

    <!-- To give some space for the game box and chat box -->
    <div style="height: 400px;">
        </div>

<style>
.buttontrans {
    background-color: transparent;
}

.buttontrans:hover {
    border: 5px solid transparent;
}

.button {
  border: none;
  color: Black;
  padding: 8px 16px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
}

.button1 {
  background-color: #e8e7e3;
}

.button1:hover {
  background-color: #c2c2c2;
}

.buttonwrap {
  border: 3px outset gray;
  background-color: lightgray;
}

.buttonwrap:active {
  border-style: inset;
}

.center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.container {
  height: 120px;
  position: relative;
}

.center-full {
  margin: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}

.otree-timer {
    color:black;
    background-color:#e8e7e3;
    border-color:black;
    position: absolute;
    top: 60px;
    left: 620px;
    width: 300px;
    height: 60px;
}


</style>

<script>
document.addEventListener("DOMContentLoaded", (event) => {
    liveSend("");
});

    var remove = 0;
    let role = js_vars; // String, either "Director" or "Matcher"

function chatFunction(message) {
    var para = document.createElement("p");
    var node = document.createTextNode(message);
    para.appendChild(node);



    if (!message.includes('Message:')){
        var element = document.getElementById("div1");
        element.appendChild(para);
    } else {
        var element = document.getElementById("div2");
        element.appendChild(para);
    }

    remove++;
}

function liveRecv(data){
    var chat = data; // String List

    // Goes no the next page if string 'nextpage' is received from the server
    if (data != 'null' && data[0] == 'nextpage'){
        document.getElementById("form").submit();
    }

    var element = document.getElementById("div1");
    var elementmbox = document.getElementById("div2");
    var shouldremove = remove;

    // Removes current chat
    for (i = 0; i < shouldremove; i++) {
        element.removeChild(element.lastChild);
        remove--;
    }
    // Removes current message that is being typed
    if (role == "Director"){
        elementmbox.removeChild(elementmbox.lastChild);
        remove--
    }

    // Draws new chat
    if (data != 'null' && data[0] != 'nextpage'){
        Array.from(chat).forEach(chatFunction);
    }

    // Removes the "Message" part for the Matcher
    if (role == "Matcher"){
        element.removeChild(element.lastChild);
        remove--;
    }

    // Makes sure it is scrolled down
    element.scrollTop = element.scrollHeight;
}
</script>
{{ endblock }}